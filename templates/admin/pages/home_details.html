{% extends "admin/base/base.html" %}

{% block custom_css %}
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
{% endblock custom_css %}

{% block content %}

<!-- Messages -->
{% if messages %}
  <div class="d-flex justify-content-center mt-5">
    <div class="col-12 col-md-6 col-lg-5 text-center">
      {% for message in messages %}
        <div class="alert alert-success alert-dismissible fade show auto-dismiss" role="alert">
          <strong>{{ message }}</strong>
        </div>
      {% endfor %}
    </div>
  </div>
{% endif %}

<!-- Company Information -->
<div class="card mt-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Company Informations</h5>
    <a href="{% url 'company_info_input' %}" class="btn btn-sm btn-warning">Edit</a>
  </div>

  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Company Name</th>
            <th>Phone</th>
            <th>Email</th>
            <th>Office Hours</th>
            <th>Friday</th>
            <th>Address</th>
            <th>District</th>
            <th>Country</th>
          </tr>
        </thead>
        <tbody>
          {% for info in all_company_info %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ info.company_name }}</td>
            <td>{{ info.phone }}</td>
            <!-- Quill-rendered fields -->
            <td>{{ info.email }}</td>
            <td>{{ info.office_hours|safe }}</td>
            <td>{{ info.friday|safe }}</td>
            <td>{{ info.house_no }}, {{ info.block }}</td>
            <td>{{ info.district }}</td>
            <td>{{ info.country }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="9" class="text-center text-muted">No data found</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Videos -->
{% for video in videos %}
<div class="card mt-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Company Videos</h5>
    <a href="{% url 'video_input' video.id %}" class="btn btn-sm btn-warning">Edit Video</a>
  </div>

  <div class="card-body text-center">
    <iframe width="560" height="315" src="{{ video.embed_url }}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
  </div>
</div>
{% endfor %}

<!-- Gallery -->
<div class="card mt-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Photo Gallery List</h5>
    <a href="{% url 'gallry_input' %}" class="btn btn-sm btn-success">Add</a>
  </div>

  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Gallery Name</th>
            <th>Image 1</th>
            <th>Image 2</th>
            <th>Image 3</th>
            <th>Description</th>
            <th class="text-center">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for gallery in all_gellary %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ gallery.gellary_name }}</td>
            <td>{% if gallery.image %}<img src="{{ gallery.image.url }}" class="img-fluid rounded" style="max-height:100px">{% endif %}</td>
            <td>{% if gallery.image1 %}<img src="{{ gallery.image1.url }}" class="img-fluid rounded" style="max-height:100px">{% endif %}</td>
            <td>{% if gallery.image2 %}<img src="{{ gallery.image2.url }}" class="img-fluid rounded" style="max-height:100px">{% endif %}</td>
            <td>
              <div id="gallery-quill-{{ forloop.counter }}" class="quill-readonly">{{ gallery.description|safe }}</div>
            </td>
            <td class="text-center">
              <a href="{% url 'gallry_update' gallery.id %}" class="btn btn-sm btn-warning">Edit</a>
              <form action="{% url 'gallry_delete' gallery.id %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-danger"
                  onclick="return confirm('Are you sure?')">Delete</button>
              </form>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center text-muted">No gallery entries found</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Goals -->
{% for goal in all_goal %}
<div class="card mt-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Company Goals</h5>
    <a href="{% url 'goal_update' goal.id %}" class="btn btn-sm btn-warning">Edit</a>
  </div>

  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Goal Title</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ goal.goal_tittle }}</td>
            <td>
              <div id="goal-quill-{{ forloop.counter }}" class="quill-readonly">{{ goal.goal_descriptions|safe }}</div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endfor %}

{% endblock content %}

{% block custom_js %}
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<script>
  // Auto-dismiss messages
  setTimeout(function () {
    document.querySelectorAll('.auto-dismiss').forEach(function (alert) {
      new bootstrap.Alert(alert).close();
    });
  }, 1500);

  // Initialize Quill editors as READONLY for display
  document.querySelectorAll('.quill-readonly').forEach(function (div) {
    new Quill(div, { theme: 'snow', readOnly: true, modules: { toolbar: false } });
  });
</script>
{% endblock custom_js %}
