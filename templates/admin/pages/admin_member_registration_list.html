{% extends "admin/base/base.html" %} {% block content %}
<div class="card mt-4">
  {% if messages %} {% for message in messages %}
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <strong>{{ message }}</strong>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  {% endfor %} {% endif %}

  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Register Account</h5>
  </div>

  <div class="card-body">
    <div class="table-responsive">
      <table
        id="example"
        class="table table-striped table-bordered table-hover align-middle"
      >
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Company Name</th>
            <th>Person Name</th>
            <th>Designation</th>
            <th>Is Aggregator</th>
            <th>Apoinment Letter</th>
            <th>CV</th>
            <th>Status</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>

        <tbody>
          {% for title in registrations %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ title.company_name }}</td>
            <td>{{ title.person_name }}</td>
            <td>{{ title.designation }}</td>
            <td>{{ title.is_aggregator }}</td>
            <td>
              {% if title.appoinment_letter %}
              <a href="{{ title.appoinment_letter.url }}" target="_blank">
                View Appointment Letter
              </a>
              {% else %} No File {% endif %}
            </td>

            <td>
              {% if title.cv %}
              <a href="{{ title.cv.url }}" target="_blank"> View CV </a>
              {% else %} No File {% endif %}
            </td>
            <td>
              <span
                style="
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        {% if title.status == 'verified' %}
            background-color: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        {% elif title.status == 'pending' %}
            background-color: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        {% elif title.status == 'rejected' %}
            background-color: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        {% else %}
            background-color: #e2e3e5;
            color: #383d41;
            border-left: 4px solid #6c757d;
        {% endif %}
    "
              >
                {{ title.status|title }}
              </span>
            </td>
            <td class="text-center">
              <div class="btn-group">
                <a
                  href="{% url 'admin_member_registration_list_details' title.id %}"
                  class="btn btn-sm btn-info"
                  >View More</a
                >

                <a
                  href="{% url 'accept' title.id %}"
                  class="btn btn-sm btn-success"
                  >Accept</a
                >

                <form
                  action="{% url 'reject' title.id %}"
                  method="post"
                  style="display: inline"
                >
                  {% csrf_token %}
                  <button
                    type="submit"
                    class="btn btn-sm btn-danger"
                    onclick="return confirm('Are you sure?');"
                  >
                    Reject
                  </button>
                </form>
              </div>
            </td>
          </tr>

          {% empty %}
          <tr>
            <td colspan="10" class="text-center text-muted">
              No records found
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ✅ DataTables CSS -->
<link
  rel="stylesheet"
  href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"
/>
<link
  rel="stylesheet"
  href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css"
/>

<!-- ✅ jQuery -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

<!-- ✅ DataTables -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<!-- ✅ Buttons -->
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>

<!-- ✅ Export dependencies -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

<script>
  $(document).ready(function () {
    $("#example").DataTable({
      dom: "Bfrtip",
      buttons: ["copy", "excel", "pdf", "print"],
      pageLength: 10,
      responsive: true,
    });
  });

  // ✅ Countdown Function
  function updateCountdowns() {
    const elements = document.querySelectorAll(".countdown");

    elements.forEach((el) => {
      const expireTime = new Date(el.getAttribute("data-expire")).getTime();
      const now = new Date().getTime();

      const distance = expireTime - now;

      if (distance <= 0) {
        el.innerHTML =
          "<span style='color:red; font-weight:bold;'>Expired</span>";
        return;
      }

      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((distance / (1000 * 60)) % 60);
      const seconds = Math.floor((distance / 1000) % 60);

      el.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
    });
  }

  // Run every second
  setInterval(updateCountdowns, 1000);
  updateCountdowns();
</script>

{% endblock content %}
